(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var Editor, Floorplan, UndoRedo, editor, findIntersection, getLengthAndRotation, removeItemFrom, renderer, stage, _ref,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ref = require('./math'), getLengthAndRotation = _ref.getLengthAndRotation, findIntersection = _ref.findIntersection;

UndoRedo = require('./undoredo');

stage = null;

renderer = null;

removeItemFrom = function(array, item) {
  var index;
  index = array.indexOf(item);
  if (index > -1) {
    return array.splice(index, 1);
  }
};

Floorplan = (function() {
  function Floorplan() {
    this.walls = [];
  }

  Floorplan.prototype.addWall = function(wall) {
    var diff, intersection, part1, part2, w, _i, _len, _ref1;
    diff = [];
    _ref1 = this.walls;
    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
      w = _ref1[_i];
      intersection = findIntersection(wall.a, wall.b, w.a, w.b);
      if (intersection !== void 0) {
        diff.push({
          operation: 'remove',
          type: 'wall',
          obj: w
        });
        part1 = {
          a: w.a,
          b: intersection
        };
        diff.push({
          operation: 'add',
          type: 'wall',
          obj: part1
        });
        part2 = {
          a: w.b,
          b: intersection
        };
        diff.push({
          operation: 'add',
          type: 'wall',
          obj: part2
        });
      }
    }
    diff.push({
      operation: 'add',
      type: 'wall',
      obj: wall
    });
    return diff;
  };

  return Floorplan;

})();

Editor = (function(_super) {
  __extends(Editor, _super);

  function Editor() {
    Editor.__super__.constructor.call(this);
    this.underlay = new PIXI.Graphics();
    this.underlay.hitArea = new PIXI.Rectangle(0, 0, 800, 600);
    this.underlay.interactive = true;
    this.addChild(this.underlay);
    this.tempGraphics = new PIXI.Graphics();
    this.addChild(this.tempGraphics);
    this.addUnderlayEvents(this.underlay);
    this.floorplan = new Floorplan();
    this.walls = [];
    this.undoRedo = new UndoRedo();
  }

  Editor.prototype.addUnderlayEvents = function(underlay) {
    underlay.mousedown = (function(_this) {
      return function(e) {
        _this.dragging = true;
        return _this.sp = {
          x: e.global.x,
          y: e.global.y
        };
      };
    })(this);
    underlay.mousemove = (function(_this) {
      return function(e) {
        if (_this.dragging) {
          _this.ep = {
            x: e.global.x,
            y: e.global.y
          };
          _this.tempGraphics.clear();
          _this.tempGraphics.lineStyle(10, 0xaa00aa);
          _this.tempGraphics.moveTo(_this.sp.x, _this.sp.y);
          _this.tempGraphics.lineTo(_this.ep.x, _this.ep.y);
          return renderer.render(stage);
        }
      };
    })(this);
    return underlay.mouseup = (function(_this) {
      return function(e) {
        _this.dragging = false;
        _this.tempGraphics.clear();
        _this.applyDiffs(_this.floorplan.addWall({
          a: _this.sp,
          b: _this.ep
        }));
        return renderer.render(stage);
      };
    })(this);
  };

  Editor.prototype.applyDiffs = function(diffs, putInUndoStack) {
    var diff, length, rotation, w, wall, wallToDelete, _i, _j, _len, _len1, _ref1, _ref2;
    if (putInUndoStack == null) {
      putInUndoStack = true;
    }
    if (putInUndoStack) {
      this.undoRedo.clearRedoFuture();
      this.undoRedo.constructUndoable(diffs);
    }
    for (_i = 0, _len = diffs.length; _i < _len; _i++) {
      diff = diffs[_i];
      if (diff.type === 'wall') {
        if (diff.operation === 'add') {
          wall = new PIXI.Graphics();
          wall.beginFill(0xffffff * Math.random());
          _ref1 = getLengthAndRotation(diff.obj.a, diff.obj.b), length = _ref1.length, rotation = _ref1.rotation;
          wall.drawRect(0, -5, length, 10);
          wall.position.x = diff.obj.a.x;
          wall.position.y = diff.obj.a.y;
          wall.rotation = rotation;
          wall.ref = diff.obj;
          this.addChild(wall);
          this.walls.push(wall);
          this.floorplan.walls.push(diff.obj);
        }
        if (diff.operation === 'remove') {
          wallToDelete = void 0;
          _ref2 = this.walls;
          for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
            w = _ref2[_j];
            if (w.ref === diff.obj) {
              wallToDelete = w;
              continue;
            }
          }
          this.removeChild(wallToDelete);
          removeItemFrom(this.walls, wallToDelete);
          removeItemFrom(this.floorplan.walls, wallToDelete.ref);
        }
      }
    }
    console.log('amount of editor  walls: ', this.walls.length);
    return console.log('amount of FP  walls: ', this.floorplan.walls.length);
  };

  return Editor;

})(PIXI.DisplayObjectContainer);

stage = new PIXI.Stage(0x888888);

renderer = new PIXI.autoDetectRenderer();

editor = new Editor();

stage.addChild(editor);

document.body.appendChild(renderer.view);

window.onload = function() {
  return renderer.render(stage);
};

window.undo = function() {
  var d;
  if (editor.undoRedo.canUndo()) {
    d = editor.undoRedo.undo();
    editor.applyDiffs(d, false);
    return renderer.render(stage);
  }
};

window.redo = function() {
  var d;
  if (editor.undoRedo.canRedo()) {
    d = editor.undoRedo.redo();
    editor.applyDiffs(d, false);
    return renderer.render(stage);
  }
};

window.info = function() {
  return editor.undoRedo.info();
};


},{"./math":2,"./undoredo":3}],2:[function(require,module,exports){
module.exports.getLengthAndRotation = function(sp, ep) {
  return {
    middle: {
      x: (sp.x + ep.x) / 2,
      y: (sp.y + ep.y) / 2
    },
    length: Math.sqrt((sp.x - ep.x) * (sp.x - ep.x) + (sp.y - ep.y) * (sp.y - ep.y)),
    rotation: Math.atan2(ep.y - sp.y, ep.x - sp.x)
  };
};

module.exports.findIntersection = function(a, b, a1, b1) {
  var denom, denomPositive, dx, dx1, dxa, dy, dy1, dya, intersection, s, t;
  dx = b.x - a.x;
  dy = b.y - a.y;
  dx1 = b1.x - a1.x;
  dy1 = b1.y - a1.y;
  denom = dx * dy1 - dx1 * dy;
  if (denom === 0) {
    return void 0;
  }
  denomPositive = denom > 0;
  dxa = a.x - a1.x;
  dya = a.y - a1.y;
  s = dx * dya - dy * dxa;
  if ((s < 0) === denomPositive) {
    return void 0;
  }
  t = dx1 * dya - dy1 * dxa;
  if ((t < 0) === denomPositive) {
    return void 0;
  }
  if ((s > denom) === denomPositive || (t > denom) === denomPositive) {
    return void 0;
  }
  t = t / denom;
  return intersection = {
    x: a.x + (t * dx),
    y: a.y + (t * dy)
  };
};


},{}],3:[function(require,module,exports){
var UndoRedo;

module.exports = UndoRedo = (function() {
  function UndoRedo() {
    this.undoStack = [];
    this.redoStack = [];
  }

  UndoRedo.prototype.constructUndoable = function(diffArray) {
    this.undoStack.push(this._negateAll(diffArray));
    return diffArray;
  };

  UndoRedo.prototype.constructRedoable = function(diffArray) {
    this.redoStack.push(this._negateAll(diffArray));
    return diffArray;
  };

  UndoRedo.prototype._negateAll = function(array) {
    var diff, negated, state, _i, _len;
    state = [];
    for (_i = 0, _len = array.length; _i < _len; _i++) {
      diff = array[_i];
      negated = this._negateDiff(diff);
      state.push(negated);
    }
    return state;
  };

  UndoRedo.prototype._negateDiff = function(diff) {
    var negatedDiff;
    negatedDiff = {};
    if (diff.operation === 'add') {
      negatedDiff.operation = 'remove';
    } else if (diff.operation === 'remove') {
      negatedDiff.operation = 'add';
    }
    negatedDiff.type = diff.type;
    negatedDiff.obj = diff.obj;
    return negatedDiff;
  };

  UndoRedo.prototype.info = function() {
    console.log('undo length: ', this.undoStack.length);
    console.log('redo length: ', this.redoStack.length);
    return console.log(JSON.stringify(this.undoStack));
  };

  UndoRedo.prototype.clearRedoFuture = function() {
    return this.redoStack = [];
  };

  UndoRedo.prototype.canUndo = function() {
    return this.undoStack.length > 0;
  };

  UndoRedo.prototype.canRedo = function() {
    return this.redoStack.length > 0;
  };

  UndoRedo.prototype.undo = function() {
    return this.constructRedoable(this.undoStack.pop());
  };

  UndoRedo.prototype.redo = function() {
    return this.constructUndoable(this.redoStack.pop());
  };

  return UndoRedo;

})();


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvdXNyL2xvY2FsL2xpYi9ub2RlX21vZHVsZXMvd2F0Y2hpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9uaWtraWtvb2xlL1Byb2plY3RzL2xldmVsX2VkaXRvci9zb3VyY2UvbWFpbi5jb2ZmZWUiLCIvVXNlcnMvbmlra2lrb29sZS9Qcm9qZWN0cy9sZXZlbF9lZGl0b3Ivc291cmNlL21hdGguY29mZmVlIiwiL1VzZXJzL25pa2tpa29vbGUvUHJvamVjdHMvbGV2ZWxfZWRpdG9yL3NvdXJjZS91bmRvcmVkby5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNDQSxJQUFBLGtIQUFBO0VBQUE7aVNBQUE7O0FBQUEsT0FBMkMsT0FBQSxDQUFRLFFBQVIsQ0FBM0MsRUFBQyw0QkFBQSxvQkFBRCxFQUF1Qix3QkFBQSxnQkFBdkIsQ0FBQTs7QUFBQSxRQUNBLEdBQVcsT0FBQSxDQUFRLFlBQVIsQ0FEWCxDQUFBOztBQUFBLEtBRUEsR0FBUSxJQUZSLENBQUE7O0FBQUEsUUFHQSxHQUFXLElBSFgsQ0FBQTs7QUFBQSxjQUtBLEdBQWlCLFNBQUMsS0FBRCxFQUFRLElBQVIsR0FBQTtBQUNiLE1BQUEsS0FBQTtBQUFBLEVBQUEsS0FBQSxHQUFRLEtBQUssQ0FBQyxPQUFOLENBQWMsSUFBZCxDQUFSLENBQUE7QUFDQSxFQUFBLElBQUcsS0FBQSxHQUFRLENBQUEsQ0FBWDtXQUNJLEtBQUssQ0FBQyxNQUFOLENBQWEsS0FBYixFQUFvQixDQUFwQixFQURKO0dBRmE7QUFBQSxDQUxqQixDQUFBOztBQUFBO0FBV2lCLEVBQUEsbUJBQUEsR0FBQTtBQUNULElBQUEsSUFBQyxDQUFBLEtBQUQsR0FBUyxFQUFULENBRFM7RUFBQSxDQUFiOztBQUFBLHNCQUdBLE9BQUEsR0FBUyxTQUFDLElBQUQsR0FBQTtBQUNMLFFBQUEsb0RB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QSxlQUFBLEdBQWlCLFNBQUEsR0FBQTtXQUNiLElBQUMsQ0FBQSxTQUFELEdBQWEsR0FEQTtFQUFBLENBakNqQixDQUFBOztBQUFBLHFCQW9DQSxPQUFBLEdBQVMsU0FBQSxHQUFBO1dBQ0wsSUFBQyxDQUFBLFNBQVMsQ0FBQyxNQUFYLEdBQW9CLEVBRGY7RUFBQSxDQXBDVCxDQUFBOztBQUFBLHFCQXNDQSxPQUFBLEdBQVMsU0FBQSxHQUFBO1dBQ0wsSUFBQyxDQUFBLFNBQVMsQ0FBQyxNQUFYLEdBQW9CLEVBRGY7RUFBQSxDQXRDVCxDQUFBOztBQUFBLHFCQXdDQSxJQUFBLEdBQU0sU0FBQSxHQUFBO1dBQ0YsSUFBQyxDQUFBLGlCQUFELENBQW1CLElBQUMsQ0FBQSxTQUFTLENBQUMsR0FBWCxDQUFBLENBQW5CLEVBREU7RUFBQSxDQXhDTixDQUFBOztBQUFBLHFCQTBDQSxJQUFBLEdBQU0sU0FBQSxHQUFBO1dBQ0YsSUFBQyxDQUFBLGlCQUFELENBQW1CLElBQUMsQ0FBQSxTQUFTLENBQUMsR0FBWCxDQUFBLENBQW5CLEVBREU7RUFBQSxDQTFDTixDQUFBOztrQkFBQTs7SUFESixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIjR3JhcGggPSByZXF1aXJlICcuL2dyYXBoJ1xue2dldExlbmd0aEFuZFJvdGF0aW9uLCBmaW5kSW50ZXJzZWN0aW9ufSA9IHJlcXVpcmUgJy4vbWF0aCdcblVuZG9SZWRvID0gcmVxdWlyZSAnLi91bmRvcmVkbydcbnN0YWdlID0gbnVsbFxucmVuZGVyZXIgPSBudWxsICAgICAgICAgIFxuXG5yZW1vdmVJdGVtRnJvbSA9IChhcnJheSwgaXRlbSkgLT5cbiAgICBpbmRleCA9IGFycmF5LmluZGV4T2YgaXRlbVxuICAgIGlmIGluZGV4ID4gLTFcbiAgICAgICAgYXJyYXkuc3BsaWNlKGluZGV4LCAxKVxuXG5jbGFzcyBGbG9vcnBsYW5cbiAgICBjb25zdHJ1Y3RvcjogLT5cbiAgICAgICAgQHdhbGxzID0gW11cblxuICAgIGFkZFdhbGw6ICh3YWxsKSAtPlxuICAgICAgICBkaWZmID0gW11cbiAgICAgICAgIyB0aGlzIGZ1bmN0aW9uIG5vdyBvbmx5IGNoZWNrcyBhbGwgT1RIRVIgd2FsbHMgdG8gc2VlIGlmIHRoZXkgc2hvdWxkIGJlIGRpdmlkZWQuXG4gICAgICAgICMgSSBhbHNvIHRoaW5rIHRoZSBvcmlnaW5hbCB3YWxsIHRoYXRzIGJlaW5nIGFkZGVkIHNob3VsZCBiZSBkaXZpZGVkIGlmIGl0IGludGVyc2VjdHMgb3RoZXJzXG4gICAgICAgIGZvciB3IGluIEB3YWxsc1xuICAgICAgICAgICAgaW50ZXJzZWN0aW9uID0gZmluZEludGVyc2VjdGlvbih3YWxsLmEsIHdhbGwuYiwgdy5hLCB3LmIpXG4gICAgICAgICAgICBpZiBpbnRlcnNlY3Rpb24gaXNudCB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICBkaWZmLnB1c2ggKHtvcGVyYXRpb246J3JlbW92ZScsIHR5cGU6J3dhbGwnLCBvYmo6d30pXG4gICAgICAgICAgICAgICAgcGFydDEgPSB7YTp3LmEsIGI6aW50ZXJzZWN0aW9ufVxuICAgICAgICAgICAgICAgIGRpZmYucHVzaCAoe29wZXJhdGlvbjonYWRkJywgdHlwZTond2FsbCcsIG9iajpwYXJ0MX0pXG4gICAgICAgICAgICAgICAgcGFydDIgPSB7YTp3LmIsIGI6aW50ZXJzZWN0aW9ufVxuICAgICAgICAgICAgICAgIGRpZmYucHVzaCAoe29wZXJhdGlvbjonYWRkJywgdHlwZTond2FsbCcsIG9iajpwYXJ0Mn0pXG4gICAgICAgIGRpZmYucHVzaCAoe29wZXJhdGlvbjonYWRkJywgdHlwZTond2FsbCcsIG9iajp3YWxsfSkgICAgXG4gICAgICAgIGRpZmZcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbmNsYXNzIEVkaXRvciBleHRlbmRzIFBJWEkuRGlzcGxheU9iamVjdENvbnRhaW5lclxuICAgIGNvbnN0cnVjdG9yOiAtPlxuICAgICAgICBzdXBlcigpXG4gICAgICAgIEB1bmRlcmxheSA9IG5ldyBQSVhJLkdyYXBoaWNzKClcbiAgICAgICAgQHVuZGVybGF5LmhpdEFyZWEgPSBuZXcgUElYSS5SZWN0YW5nbGUoMCwwLDgwMCw2MDApXG4gICAgICAgIEB1bmRlcmxheS5pbnRlcmFjdGl2ZSA9IHRydWVcbiAgICAgICAgQGFkZENoaWxkIEB1bmRlcmxheVxuICAgICAgICBAdGVtcEdyYXBoaWNzID0gbmV3IFBJWEkuR3JhcGhpY3MoKVxuICAgICAgICBAYWRkQ2hpbGQgQHRlbXBHcmFwaGljc1xuICAgICAgICBAYWRkVW5kZXJsYXlFdmVudHMoQHVuZGVybGF5KVxuICAgICAgICBAZmxvb3JwbGFuID0gbmV3IEZsb29ycGxhbigpXG4gICAgICAgIEB3YWxscyA9IFtdXG4gICAgICAgIEB1bmRvUmVkbyA9IG5ldyBVbmRvUmVkbygpXG4gICAgICAgIFxuICAgIGFkZFVuZGVybGF5RXZlbnRzOiAodW5kZXJsYXkpIC0+XG4gICAgICAgIHVuZGVybGF5Lm1vdXNlZG93biA9IChlKSA9PlxuICAgICAgICAgICAgQGRyYWdnaW5nID0gdHJ1ZVxuICAgICAgICAgICAgQHNwID0ge3g6ZS5nbG9iYWwueCwgeTplLmdsb2JhbC55fVxuXG4gICAgICAgIHVuZGVybGF5Lm1vdXNlbW92ZSA9IChlKSA9PlxuICAgICAgICAgICAgaWYgQGRyYWdnaW5nXG4gICAgICAgICAgICAgICAgQGVwID0ge3g6ZS5nbG9iYWwueCwgeTplLmdsb2JhbC55fVxuICAgICAgICAgICAgICAgIEB0ZW1wR3JhcGhpY3MuY2xlYXIoKVxuICAgICAgICAgICAgICAgIEB0ZW1wR3JhcGhpY3MubGluZVN0eWxlKDEwLDB4YWEwMGFhKVxuICAgICAgICAgICAgICAgIEB0ZW1wR3JhcGhpY3MubW92ZVRvKEBzcC54LCBAc3AueSlcbiAgICAgICAgICAgICAgICBAdGVtcEdyYXBoaWNzLmxpbmVUbyhAZXAueCwgQGVwLnkpXG4gICAgICAgICAgICAgICAgcmVuZGVyZXIucmVuZGVyIHN0YWdlXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHVuZGVybGF5Lm1vdXNldXAgPSAoZSkgPT5cbiAgICAgICAgICAgIEBkcmFnZ2luZyA9IGZhbHNlXG4gICAgICAgICAgICBAdGVtcEdyYXBoaWNzLmNsZWFyKClcbiAgICAgICAgICAgIEBhcHBseURpZmZzKEBmbG9vcnBsYW4uYWRkV2FsbCh7YTpAc3AsIGI6QGVwfSkpXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIgc3RhZ2VcblxuICAgIGFwcGx5RGlmZnM6IChkaWZmcywgcHV0SW5VbmRvU3RhY2sgPSB0cnVlKSAtPlxuICAgICAgICBpZiBwdXRJblVuZG9TdGFja1xuICAgICAgICAgICAgQHVuZG9SZWRvLmNsZWFyUmVkb0Z1dHVyZSgpICMga2lsbCAnYmFjayB0byB0aGUgZnV0dXJlIGFsdGVybmF0ZSB0aW1lbGluZSdcbiAgICAgICAgICAgIEB1bmRvUmVkby5jb25zdHJ1Y3RVbmRvYWJsZSBkaWZmc1xuICAgICAgICBmb3IgZGlmZiBpbiBkaWZmc1xuICAgICAgICAgICAgaWYgZGlmZi50eXBlIGlzICd3YWxsJ1xuICAgICAgICAgICAgICAgIGlmIGRpZmYub3BlcmF0aW9uIGlzICdhZGQnXG4gICAgICAgICAgICAgICAgICAgIHdhbGwgPSBuZXcgUElYSS5HcmFwaGljcygpXG4gICAgICAgICAgICAgICAgICAgIHdhbGwuYmVnaW5GaWxsKDB4ZmZmZmZmICogTWF0aC5yYW5kb20oKSlcbiAgICAgICAgICAgICAgICAgICAge2xlbmd0aCwgcm90YXRpb259ID0gZ2V0TGVuZ3RoQW5kUm90YXRpb24oZGlmZi5vYmouYSwgZGlmZi5vYmouYilcbiAgICAgICAgICAgICAgICAgICAgd2FsbC5kcmF3UmVjdCgwLCAtNSwgbGVuZ3RoLCAxMClcbiAgICAgICAgICAgICAgICAgICAgd2FsbC5wb3NpdGlvbi54ID0gZGlmZi5vYmouYS54XG4gICAgICAgICAgICAgICAgICAgIHdhbGwucG9zaXRpb24ueSA9IGRpZmYub2JqLmEueVxuICAgICAgICAgICAgICAgICAgICB3YWxsLnJvdGF0aW9uID0gcm90YXRpb25cbiAgICAgICAgICAgICAgICAgICAgd2FsbC5yZWYgPSBkaWZmLm9ialxuICAgICAgICAgICAgICAgICAgICBAYWRkQ2hpbGQgd2FsbFxuICAgICAgICAgICAgICAgICAgICBAd2FsbHMucHVzaCB3YWxsXG4gICAgICAgICAgICAgICAgICAgIEBmbG9vcnBsYW4ud2FsbHMucHVzaCBkaWZmLm9ialxuICAgICAgICAgICAgICAgIGlmIGRpZmYub3BlcmF0aW9uIGlzICdyZW1vdmUnXG4gICAgICAgICAgICAgICAgICAgIHdhbGxUb0RlbGV0ZSA9IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICBmb3IgdyBpbiBAd2FsbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHcucmVmIGlzIGRpZmYub2JqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FsbFRvRGVsZXRlID0gd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgICAgIEByZW1vdmVDaGlsZCB3YWxsVG9EZWxldGVcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSXRlbUZyb20gQHdhbGxzLCB3YWxsVG9EZWxldGVcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSXRlbUZyb20gQGZsb29ycGxhbi53YWxscywgd2FsbFRvRGVsZXRlLnJlZlxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2cgJ2Ftb3VudCBvZiBlZGl0b3IgIHdhbGxzOiAnLEB3YWxscy5sZW5ndGhcbiAgICAgICAgY29uc29sZS5sb2cgJ2Ftb3VudCBvZiBGUCAgd2FsbHM6ICcsIEBmbG9vcnBsYW4ud2FsbHMubGVuZ3RoXG5cbnN0YWdlID0gbmV3IFBJWEkuU3RhZ2UoMHg4ODg4ODgpXG5yZW5kZXJlciA9IG5ldyBQSVhJLmF1dG9EZXRlY3RSZW5kZXJlcigpXG5lZGl0b3IgPSBuZXcgRWRpdG9yKClcbnN0YWdlLmFkZENoaWxkIGVkaXRvclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCByZW5kZXJlci52aWV3XG5cblxud2luZG93Lm9ubG9hZCA9IC0+XG4gICAgcmVuZGVyZXIucmVuZGVyIHN0YWdlXG4gICAgXG53aW5kb3cudW5kbyA9IC0+XG4gICAgaWYgZWRpdG9yLnVuZG9SZWRvLmNhblVuZG8oKVxuICAgICAgICBkID0gZWRpdG9yLnVuZG9SZWRvLnVuZG8oKVxuICAgICAgICBlZGl0b3IuYXBwbHlEaWZmcyBkLCBmYWxzZVxuICAgICAgICByZW5kZXJlci5yZW5kZXIgc3RhZ2Vcblxud2luZG93LnJlZG8gPSAtPlxuICAgIGlmIGVkaXRvci51bmRvUmVkby5jYW5SZWRvKClcbiAgICAgICAgZCA9IGVkaXRvci51bmRvUmVkby5yZWRvKClcbiAgICAgICAgZWRpdG9yLmFwcGx5RGlmZnMgZCwgZmFsc2VcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyIHN0YWdlXG5cbndpbmRvdy5pbmZvID0gLT5cbiAgICBlZGl0b3IudW5kb1JlZG8uaW5mbygpIFxuIiwibW9kdWxlLmV4cG9ydHMuZ2V0TGVuZ3RoQW5kUm90YXRpb24gPSAoc3AsIGVwKSAtPlxuICAgIG1pZGRsZToge3g6KHNwLngrZXAueCkgLyAyLCB5OihzcC55K2VwLnkpIC8gMn0gIyBtaWRkbGUgbm90IG5lZWRlZCBhbnltb3JlXG4gICAgbGVuZ3RoOiBNYXRoLnNxcnQoKHNwLngtZXAueCkgKiAoc3AueC1lcC54KSArIChzcC55LWVwLnkpICogKHNwLnktZXAueSkpXG4gICAgcm90YXRpb246IE1hdGguYXRhbjIoZXAueS1zcC55LCBlcC54LXNwLngpXG5cbm1vZHVsZS5leHBvcnRzLmZpbmRJbnRlcnNlY3Rpb24gPSAoYSwgYiwgYTEsIGIxKSAtPlxuICAgIGR4ID0gYi54IC0gYS54XG4gICAgZHkgPSBiLnkgLSBhLnlcbiAgICBkeDEgPSBiMS54IC0gYTEueFxuICAgIGR5MSA9IGIxLnkgLSBhMS55XG4gICAgZGVub20gPSBkeCAqIGR5MSAtIGR4MSAqIGR5XG5cbiAgICBpZiBkZW5vbSBpcyAwXG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcblxuICAgIGRlbm9tUG9zaXRpdmUgPSBkZW5vbSA+IDBcblxuICAgIGR4YSA9IGEueCAtIGExLnhcbiAgICBkeWEgPSBhLnkgLSBhMS55XG5cbiAgICBzID0gZHggKiBkeWEgLSBkeSAqIGR4YVxuXG4gICAgaWYgKHMgPCAwKSBpcyBkZW5vbVBvc2l0aXZlXG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcblxuICAgIHQgPSBkeDEgKiBkeWEgLSBkeTEgKiBkeGFcblxuICAgIGlmICh0IDwgMCkgaXMgZGVub21Qb3NpdGl2ZVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG5cbiAgICBpZiAocyA+IGRlbm9tKSBpcyBkZW5vbVBvc2l0aXZlIG9yICh0ID4gZGVub20pIGlzIGRlbm9tUG9zaXRpdmVcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuXG4gICAgdCA9IHQgLyBkZW5vbVxuICAgIGludGVyc2VjdGlvbiA9IHg6YS54ICsgKHQgKiBkeCksIHk6YS55ICsgKHQgKiBkeSlcbiIsIm1vZHVsZS5leHBvcnRzID0gY2xhc3MgVW5kb1JlZG9cbiAgICBjb25zdHJ1Y3RvcjogLT5cbiAgICAgICAgQHVuZG9TdGFjayA9IFtdXG4gICAgICAgIEByZWRvU3RhY2sgPSBbXVxuXG4gICAgY29uc3RydWN0VW5kb2FibGU6IChkaWZmQXJyYXkpIC0+XG4gICAgICAgIEB1bmRvU3RhY2sucHVzaCBAX25lZ2F0ZUFsbChkaWZmQXJyYXkpXG4gICAgICAgIGRpZmZBcnJheVxuICAgICAgICBcbiAgICBjb25zdHJ1Y3RSZWRvYWJsZTogKGRpZmZBcnJheSkgLT5cbiAgICAgICAgQHJlZG9TdGFjay5wdXNoIEBfbmVnYXRlQWxsKGRpZmZBcnJheSlcbiAgICAgICAgZGlmZkFycmF5XG4gICAgICAgICBcbiAgICBfbmVnYXRlQWxsOiAoYXJyYXkpIC0+XG4gICAgICAgIHN0YXRlID0gW11cbiAgICAgICAgZm9yIGRpZmYgaW4gYXJyYXlcbiAgICAgICAgICAgIG5lZ2F0ZWQgPSBAX25lZ2F0ZURpZmYoZGlmZilcbiAgICAgICAgICAgIHN0YXRlLnB1c2ggbmVnYXRlZFxuICAgICAgICBzdGF0ZVxuICAgIF9uZWdhdGVEaWZmOiAoZGlmZikgLT5cbiAgICAgICAgbmVnYXRlZERpZmYgPSB7fVxuICAgICAgICBpZiBkaWZmLm9wZXJhdGlvbiBpcyAnYWRkJ1xuICAgICAgICAgICAgbmVnYXRlZERpZmYub3BlcmF0aW9uID0gJ3JlbW92ZSdcbiAgICAgICAgZWxzZSBpZiBkaWZmLm9wZXJhdGlvbiBpcyAncmVtb3ZlJ1xuICAgICAgICAgICAgbmVnYXRlZERpZmYub3BlcmF0aW9uID0gJ2FkZCdcbiAgICAgICAgbmVnYXRlZERpZmYudHlwZSA9IGRpZmYudHlwZVxuICAgICAgICBuZWdhdGVkRGlmZi5vYmogPSBkaWZmLm9ialxuICAgICAgICBuZWdhdGVkRGlmZlxuXG4gICAgaW5mbzogLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ3VuZG8gbGVuZ3RoOiAnLEB1bmRvU3RhY2subGVuZ3RoXG4gICAgICAgIGNvbnNvbGUubG9nICdyZWRvIGxlbmd0aDogJyxAcmVkb1N0YWNrLmxlbmd0aFxuICAgICAgICBjb25zb2xlLmxvZyBKU09OLnN0cmluZ2lmeShAdW5kb1N0YWNrKVxuXG4gICAgY2xlYXJSZWRvRnV0dXJlOiAtPlxuICAgICAgICBAcmVkb1N0YWNrID0gW11cblxuICAgIGNhblVuZG86IC0+XG4gICAgICAgIEB1bmRvU3RhY2subGVuZ3RoID4gMFxuICAgIGNhblJlZG86IC0+XG4gICAgICAgIEByZWRvU3RhY2subGVuZ3RoID4gMFxuICAgIHVuZG86IC0+XG4gICAgICAgIEBjb25zdHJ1Y3RSZWRvYWJsZSBAdW5kb1N0YWNrLnBvcCgpXG4gICAgcmVkbzogLT5cbiAgICAgICAgQGNvbnN0cnVjdFVuZG9hYmxlIEByZWRvU3RhY2sucG9wKClcbiJdfQ==
